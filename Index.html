<!DOCTYPE html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oil Portarage</title>
    <link rel="icon" type="image/png" href="https://e.top4top.io/p_3590fey0s1.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø«Ø§Ø¨ØªØ© */
        body {
            background-color: #000000;
            color: #ffffff;
            transition: all 0.3s ease;
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .input-gold {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.3);
            color: #fbbf24;
            transition: all 0.3s ease;
        }
        
        .input-gold:focus {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            outline: none;
        }
        
        .btn-gold {
            background: linear-gradient(135deg, #fbbf24, #FFA500);
            color: #000000;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating-oil {
            animation: float 6s ease-in-out infinite;
        }
        
        .gold-gradient {
            background: linear-gradient(135deg, #FFD700, #FFA500, #FFD700);
            background-size: 200% 200%;
            animation: shimmer 3s linear infinite;
        }
        
        .oil-drop {
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            position: absolute;
            animation: float 4s ease-in-out infinite;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .oil-drop:hover {
            transform: rotate(-45deg) scale(1.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .oil-drop.dragging {
            cursor: grabbing;
            z-index: 1000;
            animation: none;
            transform: rotate(-45deg) scale(1.3);
            box-shadow: 0 0 30px rgba(255, 215, 0, 1);
        }
        
        .filter-icon {
            font-size: 30px;
            position: absolute;
            animation: float 5s ease-in-out infinite;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
        }
        
        .filter-icon:hover {
            transform: scale(1.2);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        
        .filter-icon.dragging {
            cursor: grabbing;
            z-index: 1000;
            animation: none;
            transform: scale(1.4);
            text-shadow: 0 0 30px rgba(255, 215, 0, 1);
        }
        
        .bouncing {
            animation: bounce 0.6s ease-out;
        }
        
        @keyframes bounce {
            0% { transform: scale(1.5); }
            50% { transform: scale(0.8); }
            100% { transform: scale(1); }
        }
        
        .animate-fadeIn {
            animation: fadeInUp 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-highlight {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }
    </style>
</head>
<body class="h-full overflow-x-hidden">


    <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="fixed inset-0 z-0">
        <!-- Ù‚Ø·Ø±Ø§Øª Ø§Ù„Ø²ÙŠØª -->
        <div class="oil-drop draggable-item" data-type="oil" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 20%; right: 15%; animation-delay: 1s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 60%; left: 20%; animation-delay: 2s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 80%; right: 25%; animation-delay: 3s;"></div>
        <div class="oil-drop draggable-item" data-type="oil" style="top: 40%; right: 10%; animation-delay: 4s;"></div>
        
        <!-- ÙÙ„Ø§ØªØ± Ù…ØªØ­Ø±ÙƒØ© -->
        <div class="filter-icon draggable-item" data-type="filter" style="top: 15%; right: 20%; animation-delay: 0.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 35%; left: 15%; animation-delay: 1.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 55%; right: 30%; animation-delay: 2.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 75%; left: 25%; animation-delay: 3.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 25%; left: 5%; animation-delay: 4.5s;">ğŸ›¢ï¸</div>
        <div class="filter-icon draggable-item" data-type="filter" style="top: 65%; right: 5%; animation-delay: 5.5s;">ğŸ›¢ï¸</div>
    </div>

    <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <div id="majorServiceModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="glass-effect rounded-2xl p-6 max-w-lg w-full max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-yellow-400">Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙŠ Ø¨ÙˆØ±ØªØ±Ø§Ø¬</h3>
                <button onclick="closeMajorServiceModal()" class="text-gray-400 hover:text-white text-2xl">Ã—</button>
            </div>
            <div class="text-gray-300 space-y-2">
                <p class="font-semibold mb-3">Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ØªØ´Ù…Ù„:</p>
                <ul class="space-y-1 text-sm">
                    <li>* ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù„Ø§ÙƒØ§Øª</li>
                    <li>* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ù‡ÙˆØ§Ø¡</li>
                    <li>* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ù…ÙƒÙŠÙ</li>
                    <li>* Ù…Ù†Ø¸Ù Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø²ÙŠÙ†</li>
                    <li>* Ø¨Ø®Ø§Ø® Ø§Ù„ØªØµÙÙŠØ©</li>
                    <li>* ØªØ¨Ø¯ÙŠÙ„ Ø²ÙŠØª Ø§Ù„Ù…ÙƒÙŠÙ†Ø©</li>
                    <li>* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ø§Ù„Ø²ÙŠØª</li>
                    <li>* Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© (Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙˆÙ…Ø¨ÙŠÙˆØªØ±)</li>
                    <li>* ÙØ­Øµ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø²ÙŠÙˆØª ÙˆØ§Ù„Ø³ÙˆØ§Ø¦Ù„ (Ù…Ø§Ø¡ Ø±Ø§Ø¯ÙŠØªØ± - Ø²ÙŠØª Ø§Ù„Ø³ÙƒØ§Ù† - Ø²ÙŠØª Ø§Ù„Ù‚ÙŠØ±)</li>
                    <li>* ÙØ­Øµ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ÙŠØ±</li>
                    <li>* ÙØ­Øµ Ø§Ù„Ø³ÙØ§ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠØ³ÙƒØ§Øª</li>
                </ul>
                <p class="text-yellow-400 font-semibold text-center mt-4">
                    Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø£ØµÙ„ÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø±Ø³Ù…ÙŠØ©
                </p>
                <p class="text-center mt-4 text-lg font-bold text-green-400" id="majorServicePrice">
                    Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©: <span id="serviceAmount">${selectedCar?.majorService || 0}</span> Ø¯.Ùƒ
                </p>
                <div class="text-center mt-4">
                    <button onclick="copyMajorServiceInfo()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-3 rounded-lg transition-colors">
                        ğŸ“‹ Ù†Ø³Ø®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <main class="relative z-10 min-h-full flex items-center justify-center p-4">
        <div class="w-full max-w-4xl">
            <!-- Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <header class="text-center mb-8">
                <img src="https://i.top4top.io/p_35860o72q1.png" alt="Portarage Oil Logo" 
                     class="mx-auto max-w-md w-full h-auto rounded-lg shadow-lg"
                     onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            </header>

            <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
            <div id="loadingIndicator" class="glass-effect rounded-2xl p-8 mb-8 text-center hidden">
                <div class="animate-spin w-16 h-16 border-4 border-yellow-400 border-t-transparent rounded-full mx-auto mb-4"></div>
                <h2 class="text-xl font-bold text-yellow-400 mb-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</h2>
                <p class="text-gray-300">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹</p>
            </div>

            <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
            <div id="errorMessage" class="glass-effect rounded-2xl p-8 mb-8 text-center hidden">
                <div class="text-6xl mb-4">âš ï¸</div>
                <h2 class="text-xl font-bold text-red-400 mb-2">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                <p class="text-gray-300 mb-4">ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                <button onclick="location.reload()" 
                        class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-lg">
                    Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                </button>
            </div>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div id="mainContent" class="glass-effect rounded-2xl p-8 mb-8">

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù†Ø¸Ø§Ù… -->
                <div id="step1" class="step">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <button onclick="selectCalculatorType('cars')" 
                                class="btn-gold text-black font-bold p-8 rounded-lg text-xl hover:scale-105 transition-transform">
                            ğŸš— Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
                        </button>
                        <button onclick="selectCalculatorType('manual')" 
                                class="btn-gold text-black font-bold p-8 rounded-lg text-xl hover:scale-105 transition-transform">
                            âš™ï¸ Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
                        </button>
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                <div id="step2" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step1')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>

                    <h2 class="text-2xl font-bold mb-6 text-center text-yellow-400">Ø§Ø®ØªØ± Ø³ÙŠØ§Ø±ØªÙƒ</h2>

                    <!-- Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« -->
                    <div class="mb-6 relative">
                        <div class="relative">
                            <input type="text" 
                                   id="carSearch" 
                                   placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³ÙŠØ§Ø±Ø©..." 
                                   class="input-gold w-full p-4 pr-12 rounded-lg text-lg">
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-yellow-400 text-xl">
                                ğŸ”
                            </div>
                        </div>
                    </div>

                    <div id="carOptions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ÙÙ„ØªØ± -->
                <div id="step3" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step2')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ÙÙ„ØªØ±
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="selectCarTypeAndShowResults('german', 12)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù„Ù…Ø§Ù†ÙŠØ© - 12 Ø¯.Ùƒ
                        </button>
                        <button onclick="selectCarTypeAndShowResults('other', 8)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù…Ø±ÙŠÙƒÙŠØ© / ÙŠØ§Ø¨Ø§Ù†ÙŠØ© / ÙƒÙˆØ±ÙŠØ© - 8 Ø¯.Ùƒ
                        </button>
                        <button onclick="showCustomFilter()" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ø®Ø±Ù‰
                        </button>
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø± Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØµØµ -->
                    <div id="customFilterSection" class="hidden mt-6 text-center">
                        <h3 class="text-xl font-bold mb-3 text-yellow-400">Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„ÙÙ„ØªØ±</h3>
                        <div class="flex justify-center items-center gap-3">
                            <input type="number" id="customFilterPrice" min="0" step="0.1" 
                                   placeholder="Ø§Ù„Ø³Ø¹Ø±" 
                                   class="input-gold text-center text-lg p-3 rounded-lg w-32"
                                   onkeypress="handleCustomFilterEnter(event)">
                            <span class="text-lg text-gray-300">Ø¯.Ùƒ</span>
                        </div>
                        <p class="text-gray-400 mt-3 text-sm">Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                    </div>
                </div>

                <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª -->
                <div id="allOilsResult" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step3')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
                    </h2>
                    <div class="glass-effect rounded-lg p-6 mb-6">
                        <div id="carDetails" class="mb-4 text-lg">
                            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                        </div>
                        <div id="oilsList" class="space-y-3">
                            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²ÙŠÙˆØª -->
                        </div>
                    </div>
                    <div class="text-center space-y-4">
                        <button onclick="resetCalculation()" 
                                class="btn-gold text-black font-bold px-8 py-4 rounded-lg text-lg">
                            Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© - ÙƒÙ…ÙŠØ© Ø§Ù„Ø²ÙŠØª -->
                <div id="manualStep1" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('step1')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        ÙƒÙ… Ù„ØªØ± ØªØ­ØªØ§Ø¬ØŸ
                    </h2>
                    <div class="text-center">
                        <input type="number" id="litersInput" min="1" max="50" 
                               placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ù„ØªØ±Ø§Øª" 
                               class="input-gold text-center text-2xl p-4 rounded-lg w-64 mb-6">
                        <p class="text-gray-400 mb-6 text-lg">Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</p>
                        <button id="nextBtn" onclick="goToManualStep2()" 
                                class="btn-gold text-black font-bold px-8 py-4 rounded-lg text-lg opacity-50 cursor-not-allowed" 
                                disabled>
                            Ø§Ù„ØªØ§Ù„ÙŠ
                        </button>
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© - Ø§Ø®ØªÙŠØ§Ø± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© -->
                <div id="manualStep2" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('manualStep1')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    </h2>
                    <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3" id="viscosityOptions">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© - Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø²ÙŠØª -->
                <div id="manualStep3" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('manualStep2')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª
                    </h2>
                    <div class="mb-4">
                        <input type="text" id="oilSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø±ÙƒØ©..." 
                               class="input-gold w-full p-4 rounded-lg text-lg">
                    </div>
                    <div id="oilOptions" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
                    </div>
                </div>

                <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© - Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                <div id="manualStep4" class="step hidden">
                    <div class="mb-6">
                        <button onclick="showStep('manualStep3')" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù„ÙÙ„ØªØ±
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="selectCarType('german', 12)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù„Ù…Ø§Ù†ÙŠØ© - 12 Ø¯.Ùƒ
                        </button>
                        <button onclick="selectCarType('other', 8)" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ù…Ø±ÙŠÙƒÙŠØ© / ÙŠØ§Ø¨Ø§Ù†ÙŠØ© / ÙƒÙˆØ±ÙŠØ© - 8 Ø¯.Ùƒ
                        </button>
                        <button onclick="showCustomFilterManual()" 
                                class="btn-gold text-black font-bold p-6 rounded-lg text-lg">
                            Ø£Ø®Ø±Ù‰
                        </button>
                    </div>
                    
                    <!-- Ø®ÙŠØ§Ø± Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØµØµ -->
                    <div id="customFilterSectionManual" class="hidden mt-6 text-center">
                        <h3 class="text-xl font-bold mb-3 text-yellow-400">Ø£Ø¯Ø®Ù„ Ø³Ø¹Ø± Ø§Ù„ÙÙ„ØªØ±</h3>
                        <div class="flex justify-center items-center gap-3">
                            <input type="number" id="customFilterPriceManual" min="0" step="0.1" 
                                   placeholder="Ø§Ù„Ø³Ø¹Ø±" 
                                   class="input-gold text-center text-lg p-3 rounded-lg w-32"
                                   onkeypress="handleCustomFilterEnterManual(event)">
                            <span class="text-lg text-gray-300">Ø¯.Ùƒ</span>
                        </div>
                        <p class="text-gray-400 mt-3 text-sm">Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
                    </div>
                </div>

                <!-- Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
                <div id="finalResult" class="step hidden">
                    <div class="mb-6">
                        <button onclick="goBackToOilSelection()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition-colors text-lg">
                            â† Ø±Ø¬ÙˆØ¹ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø²ÙŠØª
                        </button>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-center text-yellow-400">
                        Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
                    </h2>
                    <div class="glass-effect rounded-lg p-6 mb-6">
                        <div id="invoiceDetails" class="space-y-4 text-lg">
                            <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© -->
                        </div>
                    </div>
                    <div class="text-center space-y-4">
                        <button onclick="copyMessage()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-4 rounded-lg text-lg transition-colors">
                            Ù†Ø³Ø®
                        </button>

                        <button onclick="resetCalculation()" 
                                class="btn-gold text-black font-bold px-8 py-4 rounded-lg text-lg">
                            Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let carsData = [];
        let stockData = [];
        let selectedCar = null;
        let selectedCarType = '';
        let selectedOil = null;
        let filterPrice = 0;
        let servicePrice = 15;
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ
        let isDragging = false;
        let currentDragElement = null;
        let dragOffset = { x: 0, y: 0 };



        // ØªØ±Ø¬Ù…Ø© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø§Ø±ÙƒØ§Øª
        function translateBrand(brand) {
            switch(brand.toUpperCase()) {
                case "CEPSA GENUINE": return "Ø³ÙŠØ³Ø¨Ø§ Ø§Ø³Ø¨Ø§Ù†ÙŠ ğŸ‡ªğŸ‡¸";
                case "AC DELCO": return "Ø§Ø³ÙŠ Ø¯ÙŠÙ„ÙƒÙˆ Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "MOPAR": return "Ù…ÙˆØ¨Ø§Ø± Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "GAZPROMNEFT": return "ØºØ§Ø²Ø¨Ø±ÙˆÙ… Ù†ÙØ· Ø±ÙˆØ³ÙŠ ğŸ‡·ğŸ‡º";
                case "MOBIL ONE": return "Ù…ÙˆØ¨ÙŠÙ„ ÙˆÙ† Ø§ÙˆØ±Ø¨ÙŠ ğŸ‡ªğŸ‡º";
                case "SHELL HELIX ULTRA": return "Ø´Ù„ Ù‡ÙŠÙ„ÙŠÙƒØ³ Ø£Ù„ØªØ±Ø§ Ø¹Ù…Ø§Ù†ÙŠ ğŸ‡´ğŸ‡²";
                case "RAVENOL": return "Ø±ÙŠÙÙ†ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "CASTROL": return "ÙƒØ§Ø³ØªØ±ÙˆÙ„ Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ ğŸ‡¬ğŸ‡§";
                case "WAGNER": return "ÙˆØ§Ø¬Ù†Ø± Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "DUCKHAMS": return "Ø¯Ø§ÙƒÙ‡Ø§Ù… Ø¨Ø±ÙŠØ·Ø§Ù†ÙŠ ğŸ‡¬ğŸ‡§";
                case "BIZOL": return "Ø¨ÙŠØ²ÙˆÙ„ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "VICTOR": return "ÙÙŠÙƒØªÙˆØ± Ø£Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "LIQUI MOLY": return "Ù„ÙŠÙƒÙŠ Ù…ÙˆÙ„ÙŠ Ø§Ù„Ù…Ø§Ù†ÙŠ ğŸ‡©ğŸ‡ª";
                case "MOTORCRAFT": return "Ù…ÙˆØªØ±ÙƒØ±Ø§ÙØª Ø§Ù…Ø±ÙŠÙƒÙŠ ğŸ‡ºğŸ‡¸";
                case "G-ENERGY": return "Ø¬ÙŠ-Ø¥Ù†Ø±Ø¬ÙŠ Ø¥ÙŠØ·Ø§Ù„ÙŠ ğŸ‡®ğŸ‡¹";
                case "TOTAL": return "ØªÙˆØªØ§Ù„ ÙØ±Ù†Ø³ÙŠ ğŸ‡«ğŸ‡·";
                case "TOYOTA BLUE": return "ØªÙˆÙŠÙˆØªØ§ Ø¨Ù„Ùˆ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "TOYOTA": return "ØªÙˆÙŠÙˆØªØ§ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                case "LEXUS": return "Ù„ÙƒØ²Ø³ ÙŠØ§Ø¨Ø§Ù†ÙŠ ğŸ‡¯ğŸ‡µ";
                default: return brand;
            }
        }

        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
        function getArabicCarName(carModel) {
            if (!carModel) return '';
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø·Ø©
            const parts = carModel.split(' - ');
            if (parts.length > 1) {
                return parts[1].trim(); // Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø´Ø±Ø·Ø©ØŒ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ Ù‡Ùˆ
            return carModel.trim();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
        async function loadData() {
            console.log('Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...');
            
            try {
                const carsSheetId = '1x2ongtstODqEEWh_jAwN8zLHjsYeIppk8EH_Q1CXMzk';
                const stockSheetId = '1ax4pCBDTm6Vkq-MZjmmOY1dgwKCUQS5x1GeffkUYOzI';
                
                const [carsResponse, stockResponse] = await Promise.all([
                    fetch(`https://docs.google.com/spreadsheets/d/${carsSheetId}/gviz/tq?tqx=out:csv&sheet=Cars&timestamp=${Date.now()}`),
                    fetch(`https://docs.google.com/spreadsheets/d/${stockSheetId}/gviz/tq?tqx=out:csv&sheet=Stock&timestamp=${Date.now()}`)
                ]);
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
                if (carsResponse.ok) {
                    const carsText = await carsResponse.text();
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­');
                    
                    const realCarsData = processCarsData(carsText);
                    
                    if (realCarsData.length > 0) {
                        carsData = realCarsData;
                        console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:', carsData.length, 'Ø³ÙŠØ§Ø±Ø©');
                    } else {
                        console.warn('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±Ø§Øª ØµØ§Ù„Ø­Ø©');
                    }
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:', carsResponse.status);
                }
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                if (stockResponse.ok) {
                    const stockText = await stockResponse.text();
                    console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­');
                    
                    const realStockData = processStockData(stockText);
                    
                    if (realStockData.length > 0) {
                        stockData = realStockData;
                        console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', stockData.length, 'Ø¹Ù†ØµØ±');
                    } else {
                        console.warn('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø®Ø²ÙˆÙ† ØµØ§Ù„Ø­Ø©');
                    }
                } else {
                    console.error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', stockResponse.status);
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                if (carsData.length === 0 && stockData.length === 0) {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets:', error);
                throw error;
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        function selectCalculatorType(type) {
            if (type === 'cars') {
                showStep('step2');
                displayCarOptions();
            } else if (type === 'manual') {
                showStep('manualStep1');
                setupLitersInput();
            }
        }

        // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
        function displayCarOptions() {
            const container = document.getElementById('carOptions');
            
            if (carsData.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-red-400 text-lg">
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù…ØªØ§Ø­Ø©
                    </div>
                `;
                return;
            }
            
            function renderCars(cars) {
                container.innerHTML = cars.map(car => {
                    // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    const carViscosity = car.oilType;
                    const otherViscosities = car.otherOilTypes || [];
                    const allViscosities = [carViscosity, ...otherViscosities].filter(v => v && v.trim());
                    
                    let totalAvailableOils = 0;
                    allViscosities.forEach(viscosity => {
                        const oilsCount = stockData.filter(oil => 
                            oil.type === viscosity && 
                            oil.contAvailable >= car.liters
                        ).length;
                        totalAvailableOils += oilsCount;
                    });
                    
                    return `
                        <div onclick="selectCar('${car.carModel}')" 
                             class="glass-effect p-4 rounded-lg cursor-pointer hover:bg-yellow-900 hover:bg-opacity-20 transition-all border-2 border-transparent hover:border-yellow-500 transform hover:scale-105">
                            <h3 class="text-lg font-bold text-yellow-400">${car.carModel}</h3>
                            <p class="text-gray-300 text-sm">Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª: ${allViscosities.join(', ')}</p>
                            <p class="text-gray-300 text-sm">Ø§Ù„ÙƒÙ…ÙŠØ©: ${car.liters} Ù„ØªØ±</p>
                            <p class="text-blue-400 text-sm font-semibold">${totalAvailableOils} Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</p>
                            ${totalAvailableOils === 0 ? '<p class="text-red-400 text-xs mt-1">âš ï¸ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹</p>' : ''}
                        </div>
                    `;
                }).join('');
            }
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            renderCars(carsData);
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('carSearch');
            if (searchInput) {
                searchInput.oninput = function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const filteredCars = carsData.filter(car => 
                        car.carModel.toLowerCase().includes(searchTerm)
                    );
                    renderCars(filteredCars);
                };
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø©
        function selectCar(carModel) {
            selectedCar = carsData.find(car => car.carModel === carModel);
            if (selectedCar) {
                showStep('step3');
            }
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        function selectCarTypeAndShowResults(type, price) {
            filterPrice = price;
            selectedCarType = type;
            showStep('allOilsResult');
            displayAllOilsResult();
        }

        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù„Ø³ÙŠØ§Ø±Ø©
        function displayAllOilsResult() {
            if (!selectedCar) return;
            
            // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            let carDetailsHtml = `
                <div class="border-b border-yellow-600 pb-4">
                    <h3 class="text-lg font-bold text-yellow-400 mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</h3>
                    <p class="text-base"><span class="text-gray-400">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„:</span> ${selectedCar.carModel}</p>`;
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            const carViscosity = selectedCar.oilType;
            const otherViscosities = selectedCar.otherOilTypes || [];
            const allViscosities = [carViscosity, ...otherViscosities].filter(v => v && v.trim());
            
            carDetailsHtml += `<p class="text-base"><span class="text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©:</span> ${selectedCar.liters} Ù„ØªØ±</p>
                    <p class="text-base"><span class="text-gray-400">Ø³Ø¹Ø± Ø§Ù„ÙÙ„ØªØ±:</span> ${filterPrice} Ø¯.Ùƒ</p>
                    <p class="text-base"><span class="text-gray-400">Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©:</span> ${servicePrice} Ø¯.Ùƒ</p>`;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªÙˆÙØ±Ø©
            if (selectedCar.majorService && selectedCar.majorService > 0) {
                carDetailsHtml += `
                    <p class="text-base flex items-center gap-2">
                        <span class="text-gray-400">Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©:</span> 
                        <span>${selectedCar.majorService} Ø¯.Ùƒ</span>
                        <button onclick="showMajorServiceModal()" 
                                class="bg-blue-600 hover:bg-blue-700 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm transition-colors">
                            â„¹ï¸
                        </button>
                    </p>`;
            }
            
            carDetailsHtml += `</div>`;
            document.getElementById('carDetails').innerHTML = carDetailsHtml;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
            if (allViscosities.length === 0) {
                document.getElementById('oilsList').innerHTML = `
                    <div class="text-center text-red-400 text-lg p-8">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø²ÙˆØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                    </div>
                `;
                return;
            }
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© ÙØ¹Ù„Ø§Ù‹
            const availableViscosities = allViscosities.filter(viscosity => {
                const availableOilsCount = stockData.filter(oil => 
                    oil.type === viscosity && 
                    oil.contAvailable >= selectedCar.liters
                ).length;
                return availableOilsCount > 0;
            });
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù„Ø²ÙˆØ¬Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙŠÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø©
            if (availableViscosities.length === 1) {
                const singleViscosity = availableViscosities[0];
                showViscosityOilsDirect(singleViscosity);
                return;
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£ÙƒØ«Ø± Ù…Ù† Ù„Ø²ÙˆØ¬Ø©ØŒ Ø§Ø¹Ø±Ø¶ Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¹ Ø²Ø± Ø§Ù„ÙƒÙ„
            let oilsListHtml = `
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-yellow-400 mb-4 text-center">Ø§Ø®ØªØ± Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø²Ø± "Ø§Ù„ÙƒÙ„" Ø£ÙˆÙ„Ø§Ù‹
            const totalAvailableOils = availableViscosities.reduce((total, viscosity) => {
                return total + stockData.filter(oil => 
                    oil.type === viscosity && 
                    oil.contAvailable >= selectedCar.liters
                ).length;
            }, 0);
            
            oilsListHtml += `
                <button onclick="showAllViscosityOils()" 
                        class="btn-gold text-black font-bold p-4 rounded-lg text-lg hover:scale-105 transition-transform col-span-full">
                    Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
                    <br>
                    <span class="text-sm">${totalAvailableOils} Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</span>
                </button>
            `;
            
            allViscosities.forEach(viscosity => {
                // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø²ÙˆØ¬Ø©
                const availableOilsCount = stockData.filter(oil => 
                    oil.type === viscosity && 
                    oil.contAvailable >= selectedCar.liters
                ).length;
                
                oilsListHtml += `
                    <button onclick="showViscosityOils('${viscosity}')" 
                            class="btn-gold text-black font-bold p-4 rounded-lg text-lg hover:scale-105 transition-transform ${availableOilsCount === 0 ? 'opacity-50 cursor-not-allowed' : ''}">
                        ${viscosity}
                        <br>
                        <span class="text-sm">${availableOilsCount} Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø©</span>
                    </button>
                `;
            });
            
            oilsListHtml += `
                    </div>
                </div>
                <div id="selectedViscosityOils" class="hidden">
                    <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙŠÙˆØª Ù‡Ù†Ø§ -->
                </div>
            `;
            
            document.getElementById('oilsList').innerHTML = oilsListHtml;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙŠÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©
        function showViscosityOilsDirect(viscosity) {
            if (!selectedCar) return;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø²ÙˆØ¬Ø©
            const availableOils = stockData.filter(oil => 
                oil.type === viscosity && 
                oil.contAvailable >= selectedCar.liters
            );
            
            if (availableOils.length === 0) {
                document.getElementById('oilsList').innerHTML = `
                    <div class="text-center text-red-400 text-lg p-8">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ${selectedCar.liters} Ù„ØªØ±
                    </div>
                `;
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø£Ø±Ø®Øµ Ù„Ù„Ø£ØºÙ„Ù‰
            const sortedOils = availableOils.sort((a, b) => a.price - b.price);
            
            let oilsHtml = `
                <div>
                    <h3 class="text-xl font-bold text-yellow-400 mb-4 text-center">
                        Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity}
                    </h3>
                    <div class="space-y-3">
            `;
            
            sortedOils.forEach((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                oilsHtml += `
                    <div class="glass-effect p-4 rounded-lg border-l-4 border-yellow-500">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="text-lg font-bold text-yellow-400">${translateBrand(oil.brand)}</h4>
                                <p class="text-gray-300 text-sm">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.type}</p>
                                <p class="text-gray-300 text-sm">Ø§Ù„Ø³Ø¹Ø±: ${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                                <p class="text-blue-400 text-sm">Ù…ØªÙˆÙØ±: ${oil.contAvailable} Ù„ØªØ±</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-green-400">${grandTotal.toFixed(3)} Ø¯.Ùƒ</p>
                                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <div class="text-sm text-gray-400">
                                Ø§Ù„Ø²ÙŠØª: ${oilTotal.toFixed(3)} + Ø§Ù„ÙÙ„ØªØ±: ${filterPrice} + Ø§Ù„Ø®Ø¯Ù…Ø©: ${servicePrice}
                            </div>
                            <button onclick="copyViscosityOilDirect(${index}, '${viscosity}')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
                                Ù†Ø³Ø®
                            </button>
                        </div>
                    </div>
                `;
            });
            
            oilsHtml += `
                    </div>
                    <div class="text-center mt-6">
                        <button onclick="copyAllViscosityOilsDirect('${viscosity}')" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-3 rounded-lg text-lg transition-colors">
                            ğŸ“‹ Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø²ÙŠÙˆØª ${viscosity}
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('oilsList').innerHTML = oilsHtml;
            
            // Ø­ÙØ¸ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù†Ø³Ø®
            window.currentViscosityOils = sortedOils;
            window.currentViscosity = viscosity;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙŠÙˆØª Ù„Ø¯Ø±Ø¬Ø© Ù„Ø²ÙˆØ¬Ø© Ù…Ø­Ø¯Ø¯Ø©
        function showViscosityOils(viscosity) {
            if (!selectedCar) return;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø²ÙˆØ¬Ø©
            const availableOils = stockData.filter(oil => 
                oil.type === viscosity && 
                oil.contAvailable >= selectedCar.liters
            );
            
            if (availableOils.length === 0) {
                document.getElementById('selectedViscosityOils').innerHTML = `
                    <div class="text-center text-red-400 text-lg p-8">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ${selectedCar.liters} Ù„ØªØ±
                    </div>
                `;
                document.getElementById('selectedViscosityOils').classList.remove('hidden');
                return;
            }
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø£Ø±Ø®Øµ Ù„Ù„Ø£ØºÙ„Ù‰
            const sortedOils = availableOils.sort((a, b) => a.price - b.price);
            
            let oilsHtml = `
                <div class="border-t border-yellow-600 pt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-yellow-400">
                            Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© - Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity}
                        </h3>
                        <button onclick="hideViscosityOils()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Ø¥Ø®ÙØ§Ø¡
                        </button>
                    </div>
                    <div class="space-y-3">
            `;
            
            sortedOils.forEach((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                oilsHtml += `
                    <div class="glass-effect p-4 rounded-lg border-l-4 border-yellow-500">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="text-lg font-bold text-yellow-400">${translateBrand(oil.brand)}</h4>
                                <p class="text-gray-300 text-sm">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.type}</p>
                                <p class="text-gray-300 text-sm">Ø§Ù„Ø³Ø¹Ø±: ${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                                <p class="text-blue-400 text-sm">Ù…ØªÙˆÙØ±: ${oil.contAvailable} Ù„ØªØ±</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold text-green-400">${grandTotal.toFixed(3)} Ø¯.Ùƒ</p>
                                <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-3">
                            <div class="text-sm text-gray-400">
                                Ø§Ù„Ø²ÙŠØª: ${oilTotal.toFixed(3)} + Ø§Ù„ÙÙ„ØªØ±: ${filterPrice} + Ø§Ù„Ø®Ø¯Ù…Ø©: ${servicePrice}
                            </div>
                            <button onclick="copyViscosityOil(${index}, '${viscosity}')" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
                                Ù†Ø³Ø®
                            </button>
                        </div>
                    </div>
                `;
            });
            
            oilsHtml += `
                    </div>
                    <div class="text-center mt-6">
                        <button onclick="copyAllViscosityOils('${viscosity}')" 
                                class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-6 py-3 rounded-lg text-lg transition-colors">
                            ğŸ“‹ Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø²ÙŠÙˆØª ${viscosity}
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('selectedViscosityOils').innerHTML = oilsHtml;
            document.getElementById('selectedViscosityOils').classList.remove('hidden');
            
            // Ø­ÙØ¸ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ù†Ø³Ø®
            window.currentViscosityOils = sortedOils;
            window.currentViscosity = viscosity;
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ø²ÙŠÙˆØª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function hideViscosityOils() {
            document.getElementById('selectedViscosityOils').classList.add('hidden');
        }
        
        // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª ÙÙŠ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©
        function showAllViscosityOils() {
            if (!selectedCar) return;
            
            const carViscosity = selectedCar.oilType;
            const otherViscosities = selectedCar.otherOilTypes || [];
            const allViscosities = [carViscosity, ...otherViscosities].filter(v => v && v.trim());
            
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© ÙØ¹Ù„Ø§Ù‹
            const availableViscosities = allViscosities.filter(viscosity => {
                const availableOilsCount = stockData.filter(oil => 
                    oil.type === viscosity && 
                    oil.contAvailable >= selectedCar.liters
                ).length;
                return availableOilsCount > 0;
            });
            
            if (availableViscosities.length === 0) {
                document.getElementById('selectedViscosityOils').innerHTML = `
                    <div class="text-center text-red-400 text-lg p-8">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ù„Ø£ÙŠ Ù…Ù† Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    </div>
                `;
                document.getElementById('selectedViscosityOils').classList.remove('hidden');
                return;
            }
            
            let allOilsHtml = `
                <div class="border-t border-yellow-600 pt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-yellow-400">
                            Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
                        </h3>
                        <button onclick="hideViscosityOils()" 
                                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                            Ø¥Ø®ÙØ§Ø¡
                        </button>
                    </div>
            `;
            
            // Ø¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ù…Ù† ÙƒÙ„ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
            let allOilsData = [];
            
            availableViscosities.forEach(viscosity => {
                const viscosityOils = stockData.filter(oil => 
                    oil.type === viscosity && 
                    oil.contAvailable >= selectedCar.liters
                );
                
                viscosityOils.forEach(oil => {
                    allOilsData.push({
                        ...oil,
                        viscosity: viscosity
                    });
                });
            });
            
            // ØªØ±ØªÙŠØ¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø±
            allOilsData.sort((a, b) => a.price - b.price);
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ù„Ù„Ø¹Ø±Ø¶
            const groupedByViscosity = {};
            allOilsData.forEach(oil => {
                if (!groupedByViscosity[oil.viscosity]) {
                    groupedByViscosity[oil.viscosity] = [];
                }
                groupedByViscosity[oil.viscosity].push(oil);
            });
            
            // Ø¹Ø±Ø¶ ÙƒÙ„ Ù„Ø²ÙˆØ¬Ø© Ù…Ø¹ Ø²ÙŠÙˆØªÙ‡Ø§
            Object.keys(groupedByViscosity).forEach(viscosity => {
                const oils = groupedByViscosity[viscosity];
                
                allOilsHtml += `
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-yellow-400 mb-4 border-b border-yellow-600 pb-2">
                            Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} (${oils.length} Ø²ÙŠØª Ù…ØªÙˆÙØ±)
                        </h4>
                        <div class="space-y-3">
                `;
                
                oils.forEach((oil, index) => {
                    const oilTotal = oil.price * selectedCar.liters;
                    const grandTotal = oilTotal + filterPrice + servicePrice;
                    
                    allOilsHtml += `
                        <div class="glass-effect p-4 rounded-lg border-l-4 border-yellow-500">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h5 class="text-lg font-bold text-yellow-400">${translateBrand(oil.brand)}</h5>
                                    <p class="text-gray-300 text-sm">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.viscosity}</p>
                                    <p class="text-gray-300 text-sm">Ø§Ù„Ø³Ø¹Ø±: ${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                                    <p class="text-blue-400 text-sm">Ù…ØªÙˆÙØ±: ${oil.contAvailable} Ù„ØªØ±</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-xl font-bold text-green-400">${grandTotal.toFixed(3)} Ø¯.Ùƒ</p>
                                    <p class="text-gray-400 text-sm">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ</p>
                                </div>
                            </div>
                            <div class="text-sm text-gray-400 mt-3">
                                Ø§Ù„Ø²ÙŠØª: ${oilTotal.toFixed(3)} + Ø§Ù„ÙÙ„ØªØ±: ${filterPrice} + Ø§Ù„Ø®Ø¯Ù…Ø©: ${servicePrice}
                            </div>
                        </div>
                    `;
                });
                
                allOilsHtml += `
                        </div>
                    </div>
                `;
            });
            
            // Ø²Ø± Ù†Ø³Ø® Ø§Ù„ÙƒÙ„ ÙÙ‚Ø·
            allOilsHtml += `
                <div class="text-center mt-6 pt-6 border-t border-yellow-600">
                    <button onclick="copyAllAvailableOils()" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold px-8 py-3 rounded-lg text-lg transition-colors">
                        ğŸ“‹ Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø©
                    </button>
                </div>
            </div>
            `;
            
            document.getElementById('selectedViscosityOils').innerHTML = allOilsHtml;
            document.getElementById('selectedViscosityOils').classList.remove('hidden');
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ù†Ø³Ø®
            window.allAvailableOilsData = allOilsData;
            window.groupedOilsData = groupedByViscosity;
        }
        
        // Ù†Ø³Ø® Ø²ÙŠØª Ù…Ù† Ù„Ø²ÙˆØ¬Ø© Ù…Ø­Ø¯Ø¯Ø©
        function copyViscosityOil(index, viscosity) {
            if (!selectedCar || !window.currentViscosityOils || !window.currentViscosityOils[index]) return;
            
            const oil = window.currentViscosityOils[index];
            const oilTotal = oil.price * selectedCar.liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ

Ù…Ù†Ø§Ø³Ø¨ Ù„Ø³ÙŠØ§Ø±Ø©: ${carNameArabic}`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copyViscosityOil(${index}, '${viscosity}')"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    copyBtn.textContent = 'ØªÙ… âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                fallbackCopy(message, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø²ÙŠØª Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        function copyViscosityOilDirect(index, viscosity) {
            if (!selectedCar || !window.currentViscosityOils || !window.currentViscosityOils[index]) return;
            
            const oil = window.currentViscosityOils[index];
            const oilTotal = oil.price * selectedCar.liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ

Ù…Ù†Ø§Ø³Ø¨ Ù„Ø³ÙŠØ§Ø±Ø©: ${carNameArabic}`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copyViscosityOilDirect(${index}, '${viscosity}')"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    copyBtn.textContent = 'ØªÙ… âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                fallbackCopy(message, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø²ÙŠÙˆØª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        function copyAllViscosityOilsDirect(viscosity) {
            if (!selectedCar || !window.currentViscosityOils) return;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const messages = window.currentViscosityOils.map((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                return `${index + 1}- Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            });
            
            const allMessages = `Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø³ÙŠØ§Ø±ØªÙƒ (${carNameArabic}) Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:\n\n` + messages.join('\n\n');
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copyAllViscosityOilsDirect('${viscosity}')"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allMessages).then(() => {
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(allMessages, copyBtn, originalText);
                });
            } else {
                fallbackCopy(allMessages, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø²ÙŠØª ÙˆØ§Ø­Ø¯ Ù…Ù† Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
        function copyAllViscosityOil(brand, viscosity, price) {
            if (!selectedCar) return;
            
            const oilTotal = price * selectedCar.liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ

Ù…Ù†Ø§Ø³Ø¨ Ù„Ø³ÙŠØ§Ø±Ø©: ${carNameArabic}`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copyAllViscosityOil('${brand}', '${viscosity}', ${price})"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    copyBtn.textContent = 'ØªÙ… âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                fallbackCopy(message, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
        function copyAllAvailableOils() {
            if (!selectedCar || !window.allAvailableOilsData) return;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const messages = window.allAvailableOilsData.map((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                return `${index + 1}- Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${oil.viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            });
            
            const allMessages = `Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø³ÙŠØ§Ø±ØªÙƒ (${carNameArabic}) Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:\n\n` + messages.join('\n\n');
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector('button[onclick="copyAllAvailableOils()"]');
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allMessages).then(() => {
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-700');
                    copyBtn.classList.remove('bg-green-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-700');
                        copyBtn.classList.add('bg-green-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(allMessages, copyBtn, originalText);
                });
            } else {
                fallbackCopy(allMessages, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø¬Ù…ÙŠØ¹ Ø²ÙŠÙˆØª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function copyAllViscosityOils(viscosity) {
            if (!selectedCar || !window.currentViscosityOils) return;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const messages = window.currentViscosityOils.map((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                return `${index + 1}- Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            });
            
            const allMessages = `Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø³ÙŠØ§Ø±ØªÙƒ (${carNameArabic}) Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:\n\n` + messages.join('\n\n');
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copyAllViscosityOils('${viscosity}')"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allMessages).then(() => {
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(allMessages, copyBtn, originalText);
                });
            } else {
                fallbackCopy(allMessages, copyBtn, originalText);
            }
        }
        
        // Ù†Ø³Ø® Ø²ÙŠÙˆØª Ù„Ø²ÙˆØ¬Ø© Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª
        function copySpecificViscosityOils(viscosity) {
            if (!selectedCar || !window.groupedOilsData || !window.groupedOilsData[viscosity]) return;
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø³ÙŠØ§Ø±Ø©
            const carNameArabic = getArabicCarName(selectedCar.carModel);
            
            const oils = window.groupedOilsData[viscosity];
            const messages = oils.map((oil, index) => {
                const oilTotal = oil.price * selectedCar.liters;
                const grandTotal = oilTotal + filterPrice + servicePrice;
                
                return `${index + 1}- Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(oil.brand)} (${selectedCar.liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            });
            
            const allMessages = `Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø³ÙŠØ§Ø±ØªÙƒ (${carNameArabic}) - Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${viscosity}:\n\n` + messages.join('\n\n');
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector(`button[onclick="copySpecificViscosityOils('${viscosity}')"]`);
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allMessages).then(() => {
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(allMessages, copyBtn, originalText);
                });
            } else {
                fallbackCopy(allMessages, copyBtn, originalText);
            }
        }

        function setupLitersInput() {
            const litersInput = document.getElementById('litersInput');
            const nextBtn = document.getElementById('nextBtn');
            
            if (litersInput && nextBtn) {
                litersInput.oninput = function(e) {
                    liters = parseInt(e.target.value) || 0;
                    if (liters > 0) {
                        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
                        nextBtn.disabled = false;
                        nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        nextBtn.classList.add('hover:scale-105');
                    } else {
                        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
                        nextBtn.disabled = true;
                        nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        nextBtn.classList.remove('hover:scale-105');
                    }
                };
                
                // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
                litersInput.onkeypress = function(e) {
                    if (e.key === 'Enter' && liters > 0) {
                        goToManualStep2();
                    }
                };
            }
        }
        
        // Ø§Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ© - Ù…ØªØºÙŠØ±Ø§Øª
        let liters = 0;
        let selectedViscosity = '';

        function goToManualStep2() {
            if (liters > 0) {
                showStep('manualStep2');
                displayViscosityOptions();
            }
        }

        function displayViscosityOptions() {
            // ÙÙ„ØªØ±Ø© Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            const availableViscosities = [...new Set(
                stockData
                    .filter(item => item.contAvailable >= liters) // ÙÙ‚Ø· Ø§Ù„Ø²ÙŠÙˆØª Ø§Ù„Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    .map(item => item.type)
            )];
            
            const container = document.getElementById('viscosityOptions');
            
            if (availableViscosities.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center text-red-400 text-lg">
                        Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${liters} Ù„ØªØ±)
                        <br>
                        <button onclick="showStep('manualStep1')" class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-base mt-4">
                            ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = availableViscosities.map(viscosity => `
                <button onclick="selectViscosity('${viscosity}')" 
                        class="btn-gold text-black font-bold p-3 rounded-lg text-lg hover:scale-105 transition-transform">
                    ${viscosity}
                </button>
            `).join('');
        }

        function selectViscosity(viscosity) {
            selectedViscosity = viscosity;
            showStep('manualStep3');
            displayOilOptions();
        }

        function displayOilOptions() {
            // ÙÙ„ØªØ±Ø© Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©
            const filteredOils = stockData.filter(item => 
                item.type === selectedViscosity && 
                item.contAvailable >= liters
            );
            
            const container = document.getElementById('oilOptions');
            
            function renderOils(oils) {
                if (oils.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-full text-center text-red-400 text-lg">
                            Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠÙˆØª Ù…ØªÙˆÙØ±Ø© Ø¨Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${selectedViscosity} ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ${liters} Ù„ØªØ±
                            <br>
                            <button onclick="showStep('manualStep2')" class="btn-gold text-black font-bold px-6 py-3 rounded-lg text-base mt-4">
                                Ø§Ø®ØªÙŠØ§Ø± Ù„Ø²ÙˆØ¬Ø© Ø£Ø®Ø±Ù‰
                            </button>
                        </div>
                    `;
                    return;
                }
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø²ÙŠÙˆØª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø¹Ø± Ù…Ù† Ø§Ù„Ø£Ø±Ø®Øµ Ù„Ù„Ø£ØºÙ„Ù‰
                const sortedOils = oils.sort((a, b) => a.price - b.price);
                
                container.innerHTML = sortedOils.map(oil => `
                    <div onclick="selectOil('${oil.brand}', ${oil.price})" 
                         class="glass-effect p-3 rounded-lg cursor-pointer hover:bg-yellow-900 hover:bg-opacity-20 transition-all border-2 border-transparent hover:border-yellow-500">
                        <h3 class="text-base font-bold text-yellow-400">${translateBrand(oil.brand)}</h3>
                        <p class="text-gray-300 text-xs">Ø§Ù„Ù„Ø²ÙˆØ¬Ø©: ${oil.type}</p>
                        <p class="text-base font-bold text-green-400">${oil.price} Ø¯.Ùƒ / Ù„ØªØ±</p>
                        <p class="text-xs text-blue-400">Ù…ØªÙˆÙØ±: ${oil.contAvailable} Ù„ØªØ±</p>
                    </div>
                `).join('');
            }
            
            renderOils(filteredOils);
            
            // Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('oilSearch').oninput = function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = filteredOils.filter(oil => 
                    oil.brand.toLowerCase().includes(searchTerm) ||
                    translateBrand(oil.brand).toLowerCase().includes(searchTerm)
                );
                renderOils(filtered);
            };
        }

        function selectOil(brandName, price) {
            selectedOil = {name: brandName, price: price};
            // Ù…Ø³Ø­ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ø¨Ø­Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            const oilSearch = document.getElementById('oilSearch');
            if (oilSearch) {
                oilSearch.value = '';
            }
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙÙ„ØªØ± Ù…Ø­Ø¯Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø§Ù†ØªÙ‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ù†ØªÙŠØ¬Ø©
            if (filterPrice > 0) {
                showStep('finalResult');
                displayFinalResult();
            } else {
                showStep('manualStep4');
            }
        }

        function goBackToOilSelection() {
            showStep('manualStep3');
            displayOilOptions();
        }

        function selectCarType(type, price) {
            filterPrice = price;
            showStep('finalResult');
            displayFinalResult();
        }

        function displayFinalResult() {
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            document.getElementById('invoiceDetails').innerHTML = `
                <div class="border-b border-yellow-600 pb-4">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:</h3>
                    <p class="text-base"><span class="text-gray-400">Ù…Ø§Ø±ÙƒØ© Ø§Ù„Ø²ÙŠØª:</span> ${translateBrand(selectedOil.name)}</p>
                    <p class="text-base"><span class="text-gray-400">Ø¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø©:</span> ${selectedViscosity}</p>
                    <p class="text-base"><span class="text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©:</span> ${liters} Ù„ØªØ±</p>
                </div>
                <div class="border-b border-yellow-600 pb-4">
                    <h3 class="text-lg font-bold text-yellow-400 mb-3">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©:</h3>
                    <div class="flex justify-between text-base"><span>Ø§Ù„Ø²ÙŠØª (${liters} Ã— ${selectedOil.price})</span><span>${oilTotal.toFixed(3)} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-base"><span>Ø§Ù„ÙÙ„ØªØ±</span><span>${filterPrice} Ø¯.Ùƒ</span></div>
                    <div class="flex justify-between text-base"><span>Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©</span><span>${servicePrice} Ø¯.Ùƒ</span></div>
                </div>
                <div class="text-2xl font-bold text-center">
                    <span class="text-yellow-400">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: </span>
                    <span class="text-green-400">${grandTotal.toFixed(3)} Ø¯.Ùƒ</span>
                </div>
            `;
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => step.classList.add('hidden'));
            document.getElementById(stepId).classList.remove('hidden');
        }

        function copyMessage() {
            
            const oilTotal = selectedOil.price * liters;
            const grandTotal = oilTotal + filterPrice + servicePrice;
            
            const message = `Ù…ØªÙˆÙØ± Ø²ÙŠØª ${translateBrand(selectedOil.name)} (${liters}) Ù„ØªØ± ÙˆØ¯Ø±Ø¬Ø© Ø§Ù„Ù„Ø²ÙˆØ¬Ø© ${selectedViscosity} Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ Ù…Ø¹ ÙØ­Øµ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù…Ø³ØªÙˆÙ‰ ØºØ§Ø² Ø§Ù„Ù…ÙƒÙŠÙ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø¬Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØª Ø¨Ù‚ÙŠÙ…Ø© ${grandTotal.toFixed(3)} Ø¯Ùƒ`;
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
            const copyBtn = document.querySelector('button[onclick="copyMessage()"]');
            const originalText = copyBtn.textContent;
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø® Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Clipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    // Ù†Ø¬Ø­ Ø§Ù„Ù†Ø³Ø®
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    // ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® - Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                fallbackCopy(message, copyBtn, originalText);
            }
        }

        // Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù†Ø³Ø®
        function fallbackCopy(text, button, originalText) {
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± textarea Ù…Ø¤Ù‚Øª
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    button.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    button.classList.add('bg-green-600');
                    button.classList.remove('bg-blue-600');
                } else {
                    button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                    button.classList.add('bg-red-600');
                    button.classList.remove('bg-blue-600');
                }
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-green-600', 'bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
                
            } catch (err) {
                console.error('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ù†Ø³Ø®:', err);
                button.textContent = 'ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® âœ—';
                button.classList.add('bg-red-600');
                button.classList.remove('bg-blue-600');
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('bg-red-600');
                    button.classList.add('bg-blue-600');
                }, 2000);
            }
        }

        function showCustomFilter() {
            document.getElementById('customFilterSection').classList.remove('hidden');
        }
        
        function hideCustomFilter() {
            document.getElementById('customFilterSection').classList.add('hidden');
            document.getElementById('customFilterPrice').value = '';
        }
        
        function handleCustomFilterEnter(event) {
            if (event.key === 'Enter') {
                confirmCustomFilter();
            }
        }
        
        function confirmCustomFilter() {
            const customPrice = parseFloat(document.getElementById('customFilterPrice').value);
            if (customPrice >= 0) {
                filterPrice = customPrice;
                showStep('allOilsResult');
                displayAllOilsResult();
            } else {
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ø®ØµØµØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert
                const input = document.getElementById('customFilterPrice');
                input.style.borderColor = '#ef4444';
                input.placeholder = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­';
                setTimeout(() => {
                    input.style.borderColor = 'rgba(255, 215, 0, 0.5)';
                    input.placeholder = 'Ø§Ù„Ø³Ø¹Ø±';
                }, 2000);
            }
        }

        // Ù„Ù„Ø­Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©
        function showCustomFilterManual() {
            document.getElementById('customFilterSectionManual').classList.remove('hidden');
        }
        
        function hideCustomFilterManual() {
            document.getElementById('customFilterSectionManual').classList.add('hidden');
            document.getElementById('customFilterPriceManual').value = '';
        }
        
        function handleCustomFilterEnterManual(event) {
            if (event.key === 'Enter') {
                confirmCustomFilterManual();
            }
        }
        
        function confirmCustomFilterManual() {
            const customPrice = parseFloat(document.getElementById('customFilterPriceManual').value);
            if (customPrice >= 0) {
                filterPrice = customPrice;
                showStep('finalResult');
                displayFinalResult();
            } else {
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ù…Ø®ØµØµØ© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† alert
                const input = document.getElementById('customFilterPriceManual');
                input.style.borderColor = '#ef4444';
                input.placeholder = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± ØµØ­ÙŠØ­';
                setTimeout(() => {
                    input.style.borderColor = 'rgba(255, 215, 0, 0.5)';
                    input.placeholder = 'Ø§Ù„Ø³Ø¹Ø±';
                }, 2000);
            }
        }

        function resetCalculation() {
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
            selectedViscosity = '';
            selectedOil = null;
            selectedCar = null;
            selectedCarType = '';
            liters = 0;
            filterPrice = 0;
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
            const oilSearch = document.getElementById('oilSearch');
            const litersInput = document.getElementById('litersInput');
            const customFilterPrice = document.getElementById('customFilterPrice');
            const customFilterPriceManual = document.getElementById('customFilterPriceManual');
            
            if (oilSearch) oilSearch.value = '';
            if (litersInput) litersInput.value = '';
            if (customFilterPrice) customFilterPrice.value = '';
            if (customFilterPriceManual) customFilterPriceManual.value = '';
            
            // Ø¥Ø®ÙØ§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØµØµ
            hideCustomFilter();
            hideCustomFilterManual();
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            showStep('step1');
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª Ù„Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ§Øª
        function setupDraggableElements() {
            const draggableItems = document.querySelectorAll('.draggable-item');
            
            draggableItems.forEach((item, index) => {
                // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³Ø­Ø¨ - Ø§Ù„Ù…Ø§ÙˆØ³ ÙÙ‚Ø·
                item.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    startDrag(e, item);
                });
                
                // Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­
                item.addEventListener('dragstart', (e) => e.preventDefault());
                
                // Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                item.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    teleportElement(item);
                });
            });
            
            // ØªØªØ¨Ø¹ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§ÙˆØ³ Ù„Ù„Ø³Ø­Ø¨ ÙÙ‚Ø·
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    drag(e);
                }
            });
            
            document.addEventListener('mouseup', endDrag);
            
            // Ù…Ù†Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
            document.addEventListener('selectstart', (e) => {
                if (isDragging) e.preventDefault();
            });
        }
        
        function startDrag(e, element) {
            isDragging = true;
            currentDragElement = element;
            
            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ Ø§Ù„Ø³Ø­Ø¨
            currentDragElement.classList.add('dragging');
            currentDragElement.style.zIndex = '1000';
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø²Ø§Ø­Ø© Ø¨Ø¯Ù‚Ø©
            const rect = currentDragElement.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
            document.body.style.cursor = 'grabbing';
        }
        
        function drag(e) {
            if (!isDragging || !currentDragElement) return;
            
            e.preventDefault();
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø©
            let newX = e.clientX - dragOffset.x;
            let newY = e.clientY - dragOffset.y;
            
            // ØªØ­Ø¯ÙŠØ¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
            const windowWidth = window.innerWidth;
            const windowHeight = window.innerHeight;
            const elementWidth = currentDragElement.offsetWidth || 30;
            const elementHeight = currentDragElement.offsetHeight || 30;
            
            // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø­Ø±Ø© Ù…Ø¹ Ø­Ø¯ÙˆØ¯ Ø¨Ø³ÙŠØ·Ø©
            newX = Math.max(-10, Math.min(newX, windowWidth - elementWidth + 10));
            newY = Math.max(-10, Math.min(newY, windowHeight - elementHeight + 10));
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙˆØ±Ø§Ù‹
            currentDragElement.style.left = newX + 'px';
            currentDragElement.style.top = newY + 'px';
            currentDragElement.currentX = newX;
            currentDragElement.currentY = newY;
            currentDragElement.style.right = 'auto';
            currentDragElement.style.bottom = 'auto';
        }
        
        function endDrag(e) {
            if (!isDragging || !currentDragElement) return;
            
            isDragging = false;
            
            // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ø§Ø³ Ø§Ù„Ø³Ø­Ø¨
            currentDragElement.classList.remove('dragging');
            currentDragElement.style.zIndex = '100';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
            document.body.style.cursor = 'default';
            
            currentDragElement = null;
        }
        
        // Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù„Ù„Ø¹Ù†ØµØ±
        function teleportElement(element) {
            // ØªØ£Ø«ÙŠØ± Ø§Ù†ÙØ¬Ø§Ø±
            element.style.transform = 'scale(2)';
            element.style.opacity = '0.3';
            
            setTimeout(() => {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ…ÙˆØ¶Ø¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                const margin = 50;
                const randomX = margin + Math.random() * (window.innerWidth - margin * 2);
                const randomY = margin + Math.random() * (window.innerHeight - margin * 2);
                
                element.style.left = randomX + 'px';
                element.style.top = randomY + 'px';
                element.style.right = 'auto';
                element.style.bottom = 'auto';
                
                // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø¬Ù… ÙˆØ§Ù„Ø´ÙØ§ÙÙŠØ©
                element.style.transform = 'scale(1)';
                element.style.opacity = '1';
                
                // ØªØ£Ø«ÙŠØ± Ø¸Ù‡ÙˆØ±
                element.classList.add('bouncing');
                setTimeout(() => {
                    element.classList.remove('bouncing');
                }, 600);
            }, 200);
        }

        // ÙˆØ¸Ø§Ø¦Ù Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©
        function showMajorServiceModal() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
            const serviceAmountSpan = document.getElementById('serviceAmount');
            if (serviceAmountSpan && selectedCar && selectedCar.majorService) {
                serviceAmountSpan.textContent = selectedCar.majorService;
            }
            document.getElementById('majorServiceModal').classList.remove('hidden');
        }
        
        function closeMajorServiceModal() {
            document.getElementById('majorServiceModal').classList.add('hidden');
        }
        
        function copyMajorServiceInfo() {
            if (!selectedCar || !selectedCar.majorService) return;
            
            const message = `Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙŠ Ø¨ÙˆØ±ØªØ±Ø§Ø¬

Ø§Ù„ØªØµÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© ØªØ´Ù…Ù„:

* ØªØ¨Ø¯ÙŠÙ„ Ø¨Ù„Ø§ÙƒØ§Øª
* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ù‡ÙˆØ§Ø¡
* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ù…ÙƒÙŠÙ
* Ù…Ù†Ø¸Ù Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù†Ø²ÙŠÙ†
* Ø¨Ø®Ø§Ø® Ø§Ù„ØªØµÙÙŠØ©
* ØªØ¨Ø¯ÙŠÙ„ Ø²ÙŠØª Ø§Ù„Ù…ÙƒÙŠÙ†Ø©
* ØªØ¨Ø¯ÙŠÙ„ ÙÙ„ØªØ± Ø§Ù„Ø²ÙŠØª
* Ø¨Ø±Ù…Ø¬Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø© (Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¬Ù‡Ø§Ø² Ø§Ù„ÙƒÙˆÙ…Ø¨ÙŠÙˆØªØ±)
* ÙØ­Øµ Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø²ÙŠÙˆØª ÙˆØ§Ù„Ø³ÙˆØ§Ø¦Ù„ (Ù…Ø§Ø¡ Ø±Ø§Ø¯ÙŠØªØ± - Ø²ÙŠØª Ø§Ù„Ø³ÙƒØ§Ù† - Ø²ÙŠØª Ø§Ù„Ù‚ÙŠØ±)
* ÙØ­Øµ Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª ÙˆØ§Ù„ØªÙˆØ§ÙŠØ±
* ÙØ­Øµ Ø§Ù„Ø³ÙØ§ÙŠÙ ÙˆØ§Ù„Ø¯ÙŠØ³ÙƒØ§Øª

Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø£ØµÙ„ÙŠØ© Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø§Ù„Ø±Ø³Ù…ÙŠØ©

Ø±Ø³ÙˆÙ… Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø©: ${selectedCar.majorService} Ø¯.Ùƒ`;
            
            const copyBtn = document.querySelector('button[onclick="copyMajorServiceInfo()"]');
            const originalText = copyBtn.textContent;
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(message).then(() => {
                    copyBtn.textContent = 'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ“';
                    copyBtn.classList.add('bg-green-600');
                    copyBtn.classList.remove('bg-blue-600');
                    
                    setTimeout(() => {
                        copyBtn.textContent = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-blue-600');
                    }, 2000);
                }).catch(() => {
                    fallbackCopy(message, copyBtn, originalText);
                });
            } else {
                fallbackCopy(message, copyBtn, originalText);
            }
        }
        
        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('majorServiceModal');
            if (e.target === modal) {
                closeMajorServiceModal();
            }
        });

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        let autoUpdateInterval;
        let lastUpdateTime = 0;
        let isUpdating = false;
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª (ØµØ§Ù…Øª)
        async function checkForUpdates() {
            if (isUpdating) return;
            
            try {
                isUpdating = true;
                
                const carsSheetId = '1-hVGrK0SqiLgXV_zaqhh2bqYCjjr4Q28jzWU8gG6jTU';
                const stockSheetId = '1ax4pCBDTm6Vkq-MZjmmOY1dgwKCUQS5x1GeffkUYOzI';
                
                let hasUpdates = false;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
                try {
                    const carsUrl = `https://docs.google.com/spreadsheets/d/${carsSheetId}/gviz/tq?tqx=out:csv&sheet=Cars&timestamp=${Date.now()}`;
                    const carsResponse = await fetch(carsUrl);
                    
                    if (carsResponse.ok) {
                        const carsText = await carsResponse.text();
                        const newCarsData = processCarsData(carsText);
                        
                        if (newCarsData.length > 0 && JSON.stringify(newCarsData) !== JSON.stringify(carsData)) {
                            carsData = newCarsData;
                            hasUpdates = true;
                            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:', carsData.length, 'Ø³ÙŠØ§Ø±Ø©');
                        }
                    }
                } catch (error) {
                    console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§ØªØŒ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©');
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                try {
                    const stockUrl = `https://docs.google.com/spreadsheets/d/${stockSheetId}/gviz/tq?tqx=out:csv&sheet=Stock&timestamp=${Date.now()}`;
                    const stockResponse = await fetch(stockUrl);
                    
                    if (stockResponse.ok) {
                        const stockText = await stockResponse.text();
                        const newStockData = processStockData(stockText);
                        
                        if (newStockData.length > 0 && JSON.stringify(newStockData) !== JSON.stringify(stockData)) {
                            stockData = newStockData;
                            hasUpdates = true;
                            console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', stockData.length, 'Ø¹Ù†ØµØ±');
                        }
                    }
                } catch (error) {
                    console.log('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ØŒ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©');
                }
                
                if (hasUpdates) {
                    refreshCurrentView();
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª:', error);
            } finally {
                isUpdating = false;
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
        function processCarsData(carsText) {
            const carsRows = carsText.split('\n').map(row => {
                const cells = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < row.length; i++) {
                    const char = row[i];
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        cells.push(current.trim().replace(/"/g, ''));
                        current = '';
                    } else {
                        current += char;
                    }
                }
                cells.push(current.trim().replace(/"/g, ''));
                
                return cells;
            });
            
            return carsRows.slice(1)
                .filter(row => row.length >= 3 && row[0] && row[0].trim()) 
                .map(row => {
                    const carModel = row[0] || '';  // Ø§Ù„Ø¹Ù…ÙˆØ¯ A
                    const oilTypeCell = row[1] || '';   // Ø§Ù„Ø¹Ù…ÙˆØ¯ B
                    const liters = parseInt(row[2]) || 0; // Ø§Ù„Ø¹Ù…ÙˆØ¯ C
                    const majorService = parseFloat(row[3]) || 0; // Ø§Ù„Ø¹Ù…ÙˆØ¯ D
                    
                    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ù…Ù† Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ù…ÙØµÙˆÙ„Ø© Ø¨Ù€ , Ø£Ùˆ /
                    const allViscosities = oilTypeCell.split(/[,/]/).map(v => v.trim()).filter(v => v);
                    
                    // Ø£ÙˆÙ„ Ù„Ø²ÙˆØ¬Ø© Ù‡ÙŠ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŒ ÙˆØ§Ù„Ø¨Ø§Ù‚ÙŠ Ø¨Ø¯ÙŠÙ„Ø©
                    const oilType = allViscosities[0] || '';
                    const otherOilTypes = allViscosities.slice(1);
                    
                    const carData = {
                        carModel: carModel.trim(),
                        oilType: oilType.trim(),
                        liters: liters,
                        otherOilTypes: otherOilTypes // Ø§Ù„Ù„Ø²ÙˆØ¬Ø§Øª Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
                    };
                    
                    if (majorService > 0) {
                        carData.majorService = majorService;
                    }
                    
                    return carData;
                })
                .filter(item => item.carModel && item.oilType && item.liters > 0);
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function processStockData(stockText) {
            const stockRows = stockText.split('\n').map(row => {
                return row.split(',').map(cell => cell.replace(/"/g, '').trim());
            });
            
            return stockRows.slice(1)
                .filter(row => row.length >= 6 && row[0])
                .map(row => ({
                    brand: row[0] || '',
                    type: row[1] || '',
                    price: parseFloat(row[2]) || 0,
                    liters: parseInt(row[3]) || 0,
                    priceLiter: parseFloat(row[4]) || 0,
                    country: row[5] || '',
                    contAvailable: parseInt(row[6]) || 0,
                    brandOfOil: row[7] || row[9] || row[11] || row[13] || row[15] || row[17] || row[1] || row[19] || ''
                }))
                .filter(item => item.brand && item.type && item.price > 0 && item.contAvailable > 0);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„ÙŠ
        function refreshCurrentView() {
            const currentStep = document.querySelector('.step:not(.hidden)');
            if (!currentStep) return;
            
            const stepId = currentStep.id;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø­Ø³Ø¨ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            switch(stepId) {
                case 'step2':
                    displayCarOptions();
                    break;
                case 'allOilsResult':
                    if (selectedCar) {
                        displayAllOilsResult();
                    }
                    break;
                case 'manualStep2':
                    displayViscosityOptions();
                    break;
                case 'manualStep3':
                    if (selectedViscosity) {
                        displayOilOptions();
                    }
                    break;
                case 'finalResult':
                    if (selectedOil) {
                        displayFinalResult();
                    }
                    break;
            }
        }
        
        // Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function startAutoUpdate() {
            // Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            autoUpdateInterval = setInterval(checkForUpdates, 30000);
            console.log('ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ - Ø§Ù„ØªØ­Ù‚Ù‚ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©');
        }
        
        // Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function stopAutoUpdate() {
            if (autoUpdateInterval) {
                clearInterval(autoUpdateInterval);
                autoUpdateInterval = null;
                console.log('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ');
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        async function initializeApp() {
            // Ø¹Ø±Ø¶ Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            showLoadingIndicator();
            
            try {
                await loadData();
                
                // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (carsData.length === 0 || stockData.length === 0) {
                    console.log('Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    await loadData();
                }
                
                setupDraggableElements();
                startAutoUpdate();
                
                console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${carsData.length} Ø³ÙŠØ§Ø±Ø© Ùˆ ${stockData.length} Ø²ÙŠØª Ø¨Ù†Ø¬Ø§Ø­`);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù Ù…Ù† Ø§Ù„ØªØ­Ù…ÙŠÙ„
                setTimeout(checkForUpdates, 10000);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showErrorMessage();
            } finally {
                hideLoadingIndicator();
            }
        }
        
        initializeApp();
        
        // ÙˆØ¸Ø§Ø¦Ù Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoadingIndicator() {
            document.getElementById('loadingIndicator').classList.remove('hidden');
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
        }
        
        function hideLoadingIndicator() {
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }
        
        function showErrorMessage() {
            document.getElementById('errorMessage').classList.remove('hidden');
            document.getElementById('loadingIndicator').classList.add('hidden');
            document.getElementById('mainContent').classList.add('hidden');
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', stopAutoUpdate);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99654d4527014e76',t:'MTc2MTc2ODQ3NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
